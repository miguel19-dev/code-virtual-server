<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CallBlue – Acceso</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f172a;--glass:rgba(255,255,255,0.08);--accent:#60a5fa;--green:#34d399;--text:#e2e8f0}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#1e293b,#0f172a);color:var(--text);min-height:100vh;display:grid;place-items:center}
    .container{background:var(--glass);backdrop-filter:blur(20px);border-radius:28px;padding:50px 40px;width:90%;max-width:420px;box-shadow:0 25px 50px rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.1)}
    h1{font-size:36px;text-align:center;background:linear-gradient(90deg,var(--accent),var(--green));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:40px;font-weight:700}
    .tabs{display:flex;background:rgba(255,255,255,0.1);border-radius:16px;overflow:hidden;margin-bottom:30px}
    .tab{flex:1;padding:16px;text-align:center;font-weight:600;cursor:pointer;transition:.3s}
    .tab.active{background:linear-gradient(45deg,var(--accent),var(--green));color:white}
    input{width:100%;padding:16px 20px;margin:12px 0;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.2);border-radius:16px;color:white;font-size:16px;transition:.3s}
    input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 4px rgba(96,165,250,0.3)}
    button{width:100%;padding:18px;background:linear-gradient(45deg,var(--accent),var(--green));border:none;border-radius:16px;color:white;font-size:18px;font-weight:600;cursor:pointer;margin-top:20px;transition:.4s}
    button:hover{transform:translateY(-3px);box-shadow:0 15px 30px rgba(96,165,250,0.4)}
    .avatar-preview{width:120px;height:120px;border-radius:50%;object-fit:cover;margin:20px auto;display:block;border:5px solid var(--accent);box-shadow:0 10px 30px rgba(0,0,0,0.5)}
    .file-label{display:block;text-align:center;padding:14px;background:rgba(255,255,255,0.1);border-radius:16px;cursor:pointer;margin-top:10px}
  </style>
</head>
<body>
  <div class="container">
    <h1>CallBlue</h1>
    <div class="tabs">
      <div class="tab active" onclick="show('login')">Iniciar Sesión</div>
      <div class="tab" onclick="show('register')">Registrarse</div>
    </div>

    <!-- LOGIN -->
    <div id="login">
      <input type="text" id="login-name" placeholder="Nombre de usuario" required>
      <input type="password" id="login-pass" placeholder="Contraseña" required>
      <button onclick="login()">Entrar ahora</button>
    </div>

    <!-- REGISTRO -->
    <div id="register" style="display:none">
      <input type="text" id="reg-name" placeholder="Elige tu nombre" required>
      <input type="password" id="reg-pass" placeholder="Contraseña (mín. 6 caracteres)" required>
      <img id="preview" class="avatar-preview" src="/default-avatar.png">
      <label class="file-label">
        Seleccionar foto de perfil
        <input type="file" id="avatar" accept="image/*" style="display:none" onchange="document.getElementById('preview').src=URL.createObjectURL(this.files[0])">
      </label>
      <button onclick="register()">Crear cuenta</button>
    </div>
  </div>

  <script>
    function show(mode){
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('login').style.display = mode==='login'?'block':'none';
      document.getElementById('register').style.display = mode==='register'?'block':'none';
    }
    async function login(){
      const res = await fetch('/api/login', {method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({name:document.getElementById('login-name').value.trim(),password:document.getElementById('login-pass').value})
      });
      const data = await res.json();
      if(res.ok){localStorage.setItem('currentUser',JSON.stringify(data.user));location.href='/app'}
      else alert(data.error);
    }
    async function register(){
      const form = new FormData();
      form.append('name', document.getElementById('reg-name').value.trim());
      form.append('password', document.getElementById('reg-pass').value);
      if(document.getElementById('avatar').files[0]) form.append('avatar', document.getElementById('avatar').files[0]);
      const res = await fetch('/api/register', {method:'POST', body:form});
      const data = await res.json();
      if(res.ok){localStorage.setItem('currentUser',JSON.stringify(data.user));location.href='/app'}
      else alert(data.error);
    }
  </script>
</body>
</html>